<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: none;
        }
    </style>
    <title>Mouse and Touch-following Line</title>
</head>
<body>
    <canvas id="myCanvas"></canvas>

    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

        var fixedPoint = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        var movablePoint = { x: window.innerWidth / 2, y: window.innerHeight / 2 };

        var obstacles = []; // Array to store random obstacles

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function drawLine() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update fixed point position with a smooth effect
            fixedPoint.x += (movablePoint.x - fixedPoint.x) * 0.05;
            fixedPoint.y += (movablePoint.y - fixedPoint.y) * 0.05;

            // Draw the fixed point
            ctx.beginPath();
            ctx.arc(fixedPoint.x, fixedPoint.y, 5, 0, 2 * Math.PI);
            ctx.fillStyle = "#ccc";
            ctx.fill();

            // Draw the line between fixed and movable points
            ctx.beginPath();
            ctx.moveTo(fixedPoint.x, fixedPoint.y);
            ctx.lineTo(movablePoint.x, movablePoint.y);
            ctx.strokeStyle = "#000";
            ctx.stroke();

            // Draw and update obstacles
            for (var i = 0; i < obstacles.length; i++) {
                obstacles[i].y += 2; // Adjust the speed of obstacles
                ctx.beginPath();
                ctx.arc(obstacles[i].x, obstacles[i].y, 10, 0, 2 * Math.PI);
                ctx.fillStyle = "#ff0000";
                ctx.fill();

                // Check for collision with the line
                if (isCollision(obstacles[i], fixedPoint, movablePoint)) {
                    obstacles.splice(i, 1); // Remove the obstacle
                }
            }
        }

        // Function to check for collision between a point and a line segment
        function isCollision(point, lineStart, lineEnd) {
            var d1 = dist(point.x, point.y, lineStart.x, lineStart.y);
            var d2 = dist(point.x, point.y, lineEnd.x, lineEnd.y);
            var lineLength = dist(lineStart.x, lineStart.y, lineEnd.x, lineEnd.y);

            // Tolerance to account for floating-point precision errors
            var tolerance = 0.5;

            return d1 + d2 >= lineLength - tolerance && d1 + d2 <= lineLength + tolerance;
        }

        // Function to calculate the distance between two points
        function dist(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        function updatePosition(event) {
            var clientX, clientY;

            if (event.touches && event.touches.length > 0) {
                // If multiple touch points, average their positions
                var sumX = 0;
                var sumY = 0;

                for (var i = 0; i < event.touches.length; i++) {
                    sumX += event.touches[i].clientX;
                    sumY += event.touches[i].clientY;
                }

                clientX = sumX / event.touches.length;
                clientY = sumY / event.touches.length;
            } else {
                // Single touch or mouse event
                clientX = event.clientX || event.touches[0].clientX;
                clientY = event.clientY || event.touches[0].clientY;
            }

            movablePoint.x = clientX;
            movablePoint.y = clientY;

            drawLine();
        }

        window.addEventListener("mousemove", updatePosition);
        window.addEventListener("touchmove", updatePosition);

        window.addEventListener("resize", function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            drawLine();
        });

        // Function to create random obstacles
        function createObstacle() {
            var obstacleX = Math.random() * canvas.width;
            var obstacleY = 0;
            obstacles.push({ x: obstacleX, y: obstacleY });
        }

        // Call createObstacle every second
        setInterval(createObstacle, 1000);

        // Call drawLine every 16 milliseconds (about 60 frames per second)
        setInterval(drawLine, 16);
    </script>
</body>
</html>
